const onBut=(function(){ let union="\n";let zipPromesa=Promise.resolve(""); async function putCont(array){ const val=/^(?:\/?[a-zA-Z0-9_-]+)+\.[a-zA-Z]{2}$/gm;const cont=await Promise.all(array.map(async(elemento)=>val.test(elemento)?await getUrl(elemento):elemento));return cont.join(union)}async function getUrl(url){ let data=await fetch(url);data=await data.text();return data}async function file(contenido){ let blob=new Blob([await putCont(contenido)]);return blob}async function zip(archivos){await zipPromesa;let zip=new JSZip(); for(const archivo of archivos){ const[nombre,...contenido]=archivo; if(contenido.some(elemento=>{return Array.isArray(elemento)})){ const folder=zip.folder(nombre); for(const archivo of contenido){const[nombreArchivo,...contenidoArchivo]=archivo;folder.file(nombreArchivo,await putCont(contenidoArchivo))}}else{ zip.file(nombre,await putCont(contenido))}} let blob=await zip.generateAsync({type:"blob"});return blob} return{createFile:async function(nombre,...contenido){ const desc=typeof contenido.slice(-1)[0]==="boolean"?contenido.pop():!0;const resultado=contenido.some(elemento=>{return Array.isArray(elemento)})?await zip(contenido):await file(contenido); let url=window.URL.createObjectURL(resultado);if(desc){ let link=document.createElement('a');link.href=url;link.download=nombre;link.click(); window.URL.revokeObjectURL(url);return} return{"name":nombre,"url":url}},getFile:async function(...datos){ const[archivo,descargable=!0]=datos;const respuesta=await fetch(archivo);const contenido=await respuesta.text(); let nombre=archivo;if(nombre.includes("/")){nombre=nombre.split("/").pop()}let blob=new Blob([contenido]);let url=window.URL.createObjectURL(blob);if(descargable){ let link=document.createElement("a");link.href=url;link.download=nombre;link.click(); window.URL.revokeObjectURL(url);return}return{name:nombre,url:url}},join:function(dato){union=dato??union},importZip:function(){zipPromesa=new Promise((resolve)=>{const script=document.createElement('script');script.src='https://cdnjs.cloudflare.com/ajax/libs/jszip/3.6.0/jszip.min.js';script.onload=resolve;document.head.appendChild(script)})}}})();
